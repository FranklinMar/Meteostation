{% extends 'main/layout.html' %}
{% load static %}
{% load poll_extras %}

{% block head %}
    <title>Data</title>
    <style>
/* body {
    padding: 0 80px;
} */

.button {
    /*margin-top: ;
    margin: 60px auto 0 auto;*/
    cursor: pointer;
    width: available;
    /*margin: 60px 80px 0 80px;
    margin-left: 80px;
    margin-right: 80px;*/
    display: flex;
    flex-direction: row;
    gap: 10px;
    border-radius: 10px;
    padding: 10px;
    background: #FFFFFF;
    justify-content: center;
    /*max-width: 1280px;
    width: calc(100% - 160px);*/
    min-width: fit-content;
}

.button span {
    color: #1F3C5C;
    text-align: center;
    font-style: normal;
    font-weight: 400;
    font-size: 16px;
}

.button:hover {
    transition: 0.2s;
    background: #6384A2;
}

.button:hover span {
    transition: 0.2s;
    color: #FFFFFF;
}

.button:hover path {
    fill: #FFFFFF;
}

.button:active {
    transition: 0.2s;
    background: #314C6F;
}

/*.button:active path {
    fill: #FFFFFF;
}*/

#fade {
    margin: 0;
    display: none;
    position: fixed;
    box-sizing: border-box;
    padding: 30px 30px 20px 0;
    top: 0;
    left: 0;
    width: 100%;
    /*min-height: calc(100vh + 10px);
    height: calc(100% - 50px);*/
    height: 100%;
    background: rgba(29, 29, 29, 0.6);
    z-index: 2;
}

#popup {
    -webkit-transition: 200ms linear;
    -ms-transition: 200ms linear;
    transition: 200ms linear;
    box-sizing: border-box;
    margin-left: auto;
    /*height: 840px;*/
    height:fit-content;
    max-width: 680px;
    background: #F8F8F7;
    border-radius: 20px;
    width: 100%;
    display: flex;
    flex-direction: column;
    padding: 20px;
    gap: 40px;
}

#popup .button {
    /*cursor: pointer;*/
    width: 40px;
    height: 40px;

    display: flex;
    align-items: center;
    justify-content: center;
    align-self: flex-end;
    margin: 0;

    /*background: #FFFFFF;
    border-radius: 10px;*/
}

/*#popup .button:hover {
    transition: 0.2s;
    background: #6384A2;
}*/

/*#popup .button:active {
    transition: 0.2s;
    background: #314C6F;
}*/

/*#popup .button:active path {
    fill: #FFFFFF;
}*/

#popup article {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    height: fit-content;
    justify-content: center;
}

#popup article * {
    text-align: center;
}

#popup article h1 {
    font-style: normal;
    font-weight: 500;
    font-size: 36px;
    color: #1D1D1D;
}

#popup article p {
    font-style: normal;
    font-weight: 400;
    font-size: 20px;
    color: #8C8C8C;
}

#popup .image {
    display: flex;
    flex-direction: column;
    gap: 20px;
}


#popup .image .file {
    display: flex;
    justify-content: center;
    align-items: center;

    max-width: 640px;
    width: 100%;
    height: 320px;

    background: #FFFFFF /*url(../img/image.svg)*/ no-repeat center center;
    border: 2px dashed #1F3C5C;
    border-radius: 20px;
}

#popup .image .file * {
    text-align: center;
}

#popup .image .file p {
    font-style: normal;
    font-weight: 400;
    font-size: 20px;
    color: #8C8C8C;
}

#popup .image .file p span {
    font-weight: 800;
    color: #1D1D1D;
}

#popup .image p {
    text-align: center;
    font-style: normal;
    font-weight: 400;
    font-size: 20px;
    width: 100%;
    color: #8C8C8C;
}

.lds-dual-ring {
    margin: 0 auto;
    display: none;
    /*display: inline-block;*/
    width: 80px;
    height: 80px;
}

.lds-dual-ring:after {
    content: " ";
    display: block;
    /*display: block;*/
    width: 64px;
    height: 64px;
    margin: 8px;
    border-radius: 50%;
    border: 6px solid #314C6F;
    border-color: #314C6F transparent #314C6F transparent;
    animation: lds-dual-ring 1.2s linear infinite;
}

@keyframes lds-dual-ring {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.card {
    /*margin-left: 80px;
    margin-right: 80px;*/
    margin-top: 50px;
    padding: 20px;
    background: #FFFFFF;
    border-radius: 45px;
    width: calc(100% - 160px);
}

.table {
    overflow-y: hidden;
    overflow-x: auto;
    width: 100%;
    height: fit-content;
}

table {
    width: 100%;
    /* table-layout: fixed; */
}

thead {
    display: table-header-group;
    vertical-align: middle;
    /*border: inherit;*/
    border: 1px solid #e3e6f0;
    border-collapse: separate !important;
}

/* thead */ tr {
    min-width: fit-content;
    /*padding: 5px 10px;*/
    {#display: table-caption;#}
    vertical-align: inherit;
    border: inherit;
    width: 100%;
}

thead tr:first-child {
    border-radius: 25px 25px 0 0;
}

thead tr th {
    /*padding: 10px 10px;*/
    position: relative;
    padding: 20px 5px;
    display: table-cell;
    cursor: pointer;
    border: inherit;
    font-weight: bold;
    font-size: 18px;
    color: #FFFFFF;
    background-color: #6384A2;
    min-width: fit-content;
    width: 10%;
    /*border-width: 3px;*/
}

thead tr th:before {
    position: absolute;
    right: 1em;
    content: "↓";
    bottom: 0;
    opacity: .5;
}

thead tr th.sorting-asc:before {
    opacity: 1;
}

thead tr th.sorting-desc:after {
    opacity: 1;
}

thead tr th.sorting-asc, thead tr th.sorting-desc {
    transition: 0.3s linear;
    outline: 3px solid darkblue/*#314C6F*/;
}

thead tr th:after {
    position: absolute;
    right: 0.5em;
    content: "↑";
    bottom: 0;
    opacity: .5;
}

thead tr th div {
    font-weight: inherit;
    font-size: inherit;
    color: inherit;
    {#min-width: inherit;#}
}

/*thead tr th svg {
    max-width: 20px;
    max-height: 20px;
    object-fit: contain;
}*/

thead tr:first-child th:first-child {
    /*border-top-left-radius: 25px;*/
    border-top-left-radius: inherit;
}

thead tr:first-child th:last-child {
    /*border-top-right-radius: 25px;*/
    border-top-right-radius: inherit;
}

thead th:hover {
    transition: 0.1s linear;
    outline: 2px solid darkblue/*#314C6F*/;
}

tbody {
    display: table-row-group;
    vertical-align: middle;
    /*border: inherit;*/
    border: 2px solid #e3e6f0;
    border-collapse: separate !important;
}

tbody tr {
    display: none;
}

tbody tr:nth-child(even) {
    background: #F9F4E8;
}

tbody tr:hover {
    transition: 0.1s linear;
    outline: 2px solid darkblue/*#314C6F*/;
}

tbody tr.last {
    border-radius: 0 0 25px 25px;
    /*border-bottom-left-radius: 25px;
    border-bottom-right-radius: 25px;*/
}

tbody tr.filler {
    display: table-row;
}

tbody tr td {
    /*word-break: keep-all;
    word-wrap: break-word;*/
    border: inherit;
    display: table-cell;
    /*padding: 5px;*/
    padding: 10px 5px;
    width: fit-content;
    /* width: 100%; */
}

tbody tr.last td:first-child {
    border-bottom-left-radius: inherit;
    /*padding-left: 10px;*/
}

tbody tr.last td:last-child {
    border-bottom-right-radius: inherit;
    /*padding-right: 10px;*/
}

tbody tr.filler td {
    text-align: center;
    color: inherit;
    width: 100%;
}

.margin {
    margin: 15px 0;
}

.margin-center {
    margin-left: 80px;
    margin-right: 80px;
}

.label {
    /*padding: 15px;*/
    color: #858796;
    font-size: 18px;
    height: fit-content;
}

select {
    width: fit-content;
    height: fit-content;
    padding: 0.375rem 1rem 0.375rem 0.75rem;
    /*margin: 15px 0;*/
    color: #6e707e;
    /*background: #fff url(data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='4' height='5' viewBox='0 0 4 5'%3e%3cpath fill='%235a5c69' d='M2 0L0 2h4zm0 5L0 3h4z'/%3e%3c/svg%3e) right 0.75rem center/8px 10px no-repeat;*/
    border-radius: 5px;
    font-size: 16px;
    /*border: 1px solid #858796;*/
    border: 1px solid #d1d3e2;
}

select:hover, select:focus {
    transition: 0.3s linear;
    outline: 2px solid lightblue;
}

.flex-row {
    display:flex;
    flex-direction: row;
    justify-content: space-between;
    gap: 5px;
    align-items: center;
}

.pagination {
    display: flex;
    list-style: none;
    justify-content: flex-end;
    border-radius: 0.35rem;
}

.pagination li {
    font-size: 1rem;
    font-weight: 400;
    /*line-height: 1.5;
    color: #858796;*/
    display: list-item;
    text-align: -webkit-match-parent;
    position: relative;
    /*display: block;*/
    padding: 0.5rem 0.75rem;
    margin-left: -1px;
    line-height: 1.25;
    color: #4e73df;
    /*background-color: #fff;*/
    border: 1px solid #dddfeb;
    cursor: pointer;
    /* user-select: auto; */
}

.pagination li.active {
    z-index: 3;
    color: #fff;
    background-color: #4e73df;
    border-color: #4e73df;
    pointer-events: none;
    cursor: pointer;
}

.pagination li.disabled {
    color: #858796;
    pointer-events: none;
    cursor: auto;
    /*background-color: #fff;
    border-color: #dddfeb;*/
}

.pagination li:first-child {
    margin-left: 0;
    border-radius: 0.35rem 0 0 0.35rem;
}

.pagination li:last-child {
    border-radius: 0 0.35rem 0.35rem 0;
}

.pagination li:hover {
    transition: 0.2s linear;
    background: #e5e6ea;
}

.pagination li:focus {
    transition: 0.3s linear;
    outline: 2px solid lightblue;
}

.invisible {
    display: contents;
}

.invisible li:first-child, .invisible li:last-child {
    border-radius: 0;
}
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
function popUp(bool=false) {
    if (bool) {
        $("#fade").fadeIn();
    } else {
        $("#fade").fadeOut();
    }
}
// popUp();
//const down_arrow = '<svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m5.214 14.522s4.505 4.502 6.259 6.255c.146.147.338.22.53.22s.384-.073.53-.22c1.754-1.752 6.249-6.244 6.249-6.244.144-.144.216-.334.217-.523 0-.193-.074-.386-.221-.534-.293-.293-.766-.294-1.057-.004l-4.968 4.968v-14.692c0-.414-.336-.75-.75-.75s-.75.336-.75.75v14.692l-4.979-4.978c-.289-.289-.761-.287-1.054.006-.148.148-.222.341-.221.534 0 .189.071.377.215.52z" fill-rule="nonzero"/></svg>',
//    up_arrow = '<svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m18.787 9.473s-4.505-4.502-6.259-6.255c-.147-.146-.339-.22-.53-.22-.192 0-.384.074-.531.22-1.753 1.753-6.256 6.252-6.256 6.252-.147.147-.219.339-.217.532.001.19.075.38.221.525.292.293.766.295 1.056.004l4.977-4.976v14.692c0 .414.336.75.75.75.413 0 .75-.336.75-.75v-14.692l4.978 4.978c.289.29.762.287 1.055-.006.145-.145.219-.335.221-.525.002-.192-.07-.384-.215-.529z" fill-rule="nonzero"/></svg>';
    </script>
{% endblock %}

{% block body %}

<div class="button margin-center" id="upload" onclick="popUp(true);">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16">
        <path fill="#1F3C5C" fill-rule="evenodd" d="m7.866 0 4.37 4.033-.823.892-2.924-2.7v10.137H7.276V2.305L4.673
        4.908l-.857-.858L7.866 0ZM1.213 14.787V7.511H0V16h15.766V7.51h-1.213v7.277H1.213Z" clip-rule="evenodd"></path>
    </svg>
    <span>
        UPLOAD
    </span>
</div>
<div class="card margin-center">
    <div class="flex-row margin">
        <span class="label">
            Show
            <select id="entries">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
            entries
        </span>
    </div>
    <div class="table">
        <table id="dataTable">
            <thead>
                <tr>
                    <th><div>Date</div></th>
                    <th><div>Temperature (°C)</div></th>
                    <th><div>Wind direction</div></th>
                    <th><div>Average wind speed (m/s)</div></th>
                    <th><div>Weather events</div></th>
                    <!--<th>Cloudiness</th>-->
                    <th><div>Cloud cover</div></th>
                    <th><div>Vision range (km)</div></th>
                    <th><div>Humidity (%)</div></th>
                    <th><div>Atmo pressure (GPa)</div></th>
                    <!--<th>Atmospheric pressure (GPa)</th>-->
                    <th><div>Minimal cloud height (m)</div></th>
                </tr>
            </thead>
            <tbody>
                {% if data %}
                {% for item in data %}
                <tr>
                    <td>{{ item.date|date:"d M Y H:i" }}</td>
                    <td>{{ item.temperature }}</td>
                    <td>{{ item.direction }}</td>
                    <td>{{ item.velocity }}</td>
                    <td>{{ codes|modify:item.weather_code }}</td>
                    <td>{{ dictionary|get_value:item.cloud_amount }}</td>
                    <td>{{ item.visibility_range }}</td>
                    <td>{{ item.humidity }}</td>
                    <td>{{ item.atmo_pressure }}</td>
                    <td>{{ item.lower_cloud_limit }}</td>
                </tr>
                {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>
    <div class="margin flex-row">
        <span class="label" id="show">Showing 0 to 0 of 0 entries </span>
        <ul class="pagination" id="paginator">
            <li class="disabled" id="prev">Previous</li>
            <span class="invisible" id="paginator-buttons">
            </span>
            <li id="next">Next</li>
        </ul>
    </div>
</div>
<div id="fade">
  <div id="popup">
    <div class="button" onclick="popUp();">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 18 18">
        <path fill="#1f3c5c" fill-rule="evenodd" d="M8.057 9 .53 1.471 1.47.53 9 8.057 16.529.53l.942.942L9.943 9l7.528
        7.529-.942.942L9 9.943 1.471 17.47l-.941-.94L8.057 9Z" clip-rule="evenodd"></path>
      </svg>
    </div>
    <article>
      <h1>Upload data</h1>
      <p>Upload a <span>.xslx file</span> or a <span>directory</span> with such files.</p>
    </article>

    <form id="form" class="image" enctype="multipart/form-data" method="POST">
      <label class="file">
        {% csrf_token %}
        <input id="file" type="file" name="upload" accept=".xlsx, .csv, .txt" directory multiple style="display: contents;"/><!--  accept=".xlsx, .csv, .txt" webkitdirectory -->
        <p><span>Drag here</span> your file or <span>Click here</span> to upload</p>
      </label>
      <p id="label">No file selected</p>
    <button type="submit" style="display: none; align-self: center" id="submit" class="button"><span>UPLOAD</span></button>
    <div class="lds-dual-ring"></div>
    </form>
  </div>
</div>
<script>

let text = "No file selected";
let file = document.getElementById("file");
let submit = document.getElementById("submit");
let entries = document.getElementById("entries");
let show = document.getElementById("show");

let data_table = document.getElementById("dataTable");

let paginator = document.getElementById("paginator");
let paginator_buttons = document.getElementById("paginator-buttons");
let prev = document.getElementById("prev");
let next = document.getElementById("next");

file.onchange = function() {
    let label = document.getElementById("label");

    if (this.files.length > 0) {
        label.innerHTML = `File name${ this.files.length > 1 ? "s" : "" }:&nbsp;`;
        for (let i = 0; i < this.files.length; i++) {
            label.innerHTML += `${this.files[i].name}`;
            if (this.files.length - i - 1 > 0) {
                label.innerHTML += ";&nbsp;&nbsp;"
            }
        }
        submit.style.display = "flex";
    } else {
        label.innerHTML = text;
    }
};

show.change_show = function (from, to, entries, filter=null) {
    this.innerText = `Showing ${from} to ${to} of ${entries} entries ${filter == null ? "" : filter}`;
}

submit.onclick = function() {
    this.disabled = "disabled";
    $('#submit').fadeOut();
    $('.lds-dual-ring').fadeIn().style.display = "inline-block";
};

let page = 0;
let entry_num = 10;
let rows_tr = document.querySelectorAll("tbody tr");


function hideRows() {
    let rows = document.querySelectorAll("tbody tr:not(.filler) ");

    for (let i = page * entry_num; i < Math.min((page + 1) * entry_num, rows.length); i++) {
        rows[i].removeAttribute("style");
    }
    /*let last = document.querySelector("tbody .last")
    if (last) {
        last.classList.remove("last");
    }*/
    document.querySelector("tbody .last")?.classList.remove("last");
}

function check() {
    //rows_tr = document.querySelectorAll("tbody tr");
    if (rows_tr.length === 0) {
        let row = document.createElement("tr");
        data_table.getElementsByTagName('tbody')[0].appendChild(row);
        row.classList.add("filler");
        row.classList.add("last");
        row.innerHTML = `<td colspan='${data_table.getElementsByTagName("th").length}'>No data available in table</td>`;
        return false;
    }
    return true;
}

function revealRows() {
    rows_tr = document.querySelectorAll("tbody tr");
    if (rows_tr.length !== 0) {
        let rows_num = Math.min((page + 1) * entry_num, rows_tr.length);
        for (let i = page * entry_num; i < rows_num; i++) {
            rows_tr[i].style.display = "table-row";
        }
        rows_tr[rows_num - 1].classList.add("last");
        let rows = document.querySelectorAll("tbody tr:not(.filler) ");

        show.change_show((rows.length) === 0 ? 0 : (page * entry_num) + 1, Math.min((page + 1) * entry_num, rows.length), rows.length);
    }
}

function changePaginatorButtons() {
    //rows_tr = document.querySelectorAll("tbody tr");
    let array = paginator_buttons.querySelectorAll("li");
    let last_page = Math.ceil(rows_tr.length / entry_num);
    for (let i of array) {
        i.removeAttribute("class");
    }
    if (last_page > 7) {
        if (page < 4) {
            for (let i = 1; i <= 7 - 2; i++) {
                array[i - 1].innerText = i.toString();
                if (page === i - 1) {
                    array[i - 1].classList.add("active");
                }
            }

            array[5].innerText = "...";
            array[5].classList.add("disabled");
        } else if (page >= (last_page - 4)) {

            for (let i = last_page - 4, j = 2; j < 7; i++, j++) {
                array[j].innerText = i.toString();
                if (page === (i - 1)) {
                    array[j].classList.add("active");
                }
            }
            array[1].innerText = "...";
            array[1].classList.add("disabled");
        } else {
            array[1].innerText = "...";
            array[1].classList.add("disabled");
            array[5].innerText = "...";
            array[5].classList.add("disabled");

            array[2].innerText = page.toString();
            array[3].innerText = (page + 1).toString();
            array[3].classList.add("active");
            array[4].innerText = (page + 2).toString();
        }
    } else {
        for (let i = 1; i <= array.length; i++) {
            array[i - 1].innerText = i.toString();
            if (page === (i - 1)) {
                array[i - 1].classList.add("active");
            }
        }
    }

    if (last_page === 1) {
        next.classList.add("disabled");
        prev.classList.add("disabled");
    } else {
        if (page !== last_page - 1) {
            next.classList.remove("disabled");
        } else {
            next.classList.add("disabled");
        }

        if (page !== 0) {
            prev.classList.remove("disabled");
        } else {
            prev.classList.add("disabled");
        }
    }
}

function paginateHandler() {
    //rows_tr = document.querySelectorAll("tbody tr");
    hideRows();
    page = Number(this.innerText) - 1;
    revealRows();
    changePaginatorButtons();
}

entries.onchange = function() {
    //rows_tr = document.querySelectorAll("tbody tr");
    hideRows();
    page = 0;
    entry_num = this.options[this.selectedIndex].value;
    if (check()) {
        revealRows();
    }

    paginator_buttons.innerHTML = "";
    let buttons_num = rows_tr.length / entry_num;
    if (buttons_num === 0) {
        next.classList.add("disabled");
    } else {
        let li = null;
        for (let i = 1; i <= Math.min(Math.ceil(buttons_num), 7); i++) {
            li = document.createElement("li");
            if (i === 1) {
                li.innerText = i.toString();
            }
            li.onclick = paginateHandler;
            paginator_buttons.appendChild(li);
        }
        li.innerText = Math.ceil(buttons_num).toString();
        changePaginatorButtons();
    }
};


prev.onclick = function() {
    //rows_tr = document.querySelectorAll("tbody tr");
    if (page !== 0) {
        hideRows()
        page--;
        revealRows();
        changePaginatorButtons();
    }
}

next.onclick = function() {
    //rows_tr = document.querySelectorAll("tbody tr");
    if (page !== Math.ceil(rows_tr.length / entry_num - 1)) {
        hideRows()
        page++;
        revealRows();
        changePaginatorButtons();
    }
}
let ths = data_table.querySelectorAll("thead tr th");
{#console.log(ths);#}

function sortHandler() {
    let order = true;
    if (this.classList.contains("sorting-asc")) {
        this.classList.remove("sorting-asc");
        this.classList.add("sorting-desc");
        order = false;
    } else if (this.classList.contains("sorting-desc")) {
        this.classList.remove("sorting-desc");
        this.classList.add("sorting-asc");
    } else {
        data_table.querySelector("thead tr th.sorting-asc")?.classList.remove("sorting-asc");
        data_table.querySelector("thead tr th.sorting-desc")?.classList.remove("sorting-desc");
        this.classList.add("sorting-asc");
    }
    {#hideRows();#}
    sort(rows_tr, order, Number(this.getAttribute("data-column")));
    {#revealRows();#}
}

function swap(items, leftIndex, rightIndex) {
    /*let temp = items[leftIndex];
    items[leftIndex] = items[rightIndex];
    items[rightIndex] = temp;*/
    let temp = items[leftIndex].innerHTML;
    items[leftIndex].innerHTML = items[rightIndex].innerHTML;
    items[rightIndex].innerHTML = temp;
    {#items[leftIndex].parentNode.insertBefore(items[rightIndex], items[leftIndex]);#}
}
let regex = new RegExp("[0-9]{2} [A-Za-z]{3} [0-9]{4} [0-9]{2}:[0-9]{2}");
function partition(items, left, right, order, column_num) {
    let pivot = items[Math.floor((right + left) / 2)].getElementsByTagName("td")[column_num],
        i = left,
        j = right,
        templ,
        tempr;
    while (i <= j) {
        //if (order) {
            while (true) {
                templ = items[i].getElementsByTagName("td")[column_num].innerText;
                tempr = pivot.innerText;
                if (regex.test(templ) || regex.test(tempr)) {
                    templ = Date.parse(templ);
                    tempr = Date.parse(tempr);
                }
                if ((templ < tempr && order) || (templ > tempr && !order)) {
                    i++;
                } else {
                    break;
                }
            }
        /*} else {
            while (true) {
                if (Date.parse(items[i].getElementsByTagName("td")[column_num].innerText) > Date.parse(pivot.innerText)) {
                    i++;
                } else {
                    break;
                }
            }
        }*/

        //if (order) {
            while (true) {
                templ = items[j].getElementsByTagName("td")[column_num].innerText;
                tempr = pivot.innerText;
                if (regex.test(templ) || regex.test(tempr)) {
                    templ = Date.parse(templ);
                    tempr = Date.parse(tempr);
                }
                if ((templ > tempr && order) || (templ < tempr && !order)) {
                    j--;
                } else {
                    break;
                }
            }
        /*} else {
            while (true) {
                if (Date.parse(items[j].getElementsByTagName("td")[column_num].innerText) < Date.parse(pivot.innerText)) {
                    j--;
                } else {
                    break;
                }
            }
        }*/

        if (i <= j) {
            /*console.log(`Pivot: ${pivot}, leftIndex: ${i}, rightIndex: ${j}, leftIndexValue: ${
                items[i].getElementsByTagName("td")[column_num].innerText}, rightIndexValue ${items[j].getElementsByTagName("td")[column_num].innerText}`)*/
            swap(items, i, j);
            i++;
            j--;
        }
    }
    return i;
}

function quickSort(items, left, right, order, column_num) {
    let index;

    if (items.length > 1) {
        index = partition(items, left, right, order, column_num);

        if (left < index - 1) {
            quickSort(items, left, index - 1, order, column_num);
        }

        if (index < right) {
            quickSort(items, index, right, order, column_num);
        }
    }

    {#return items;#}
}

function sort(array, order, column_num) {
    {#console.log(column_num);#}
    {#console.log(order);#}
    page = 0;
    quickSort(array, 0, array.length - 1, order, column_num)
    {#console.log(array);#}
}

/*function sort(column_num, order) {
    let switching = true, should_switch, rows, x, y, i;
    rows = data_table.querySelectorAll("tbody tr");

    while (switching) {
        switching = false;

        for (i = 0; i < (rows.length - 1); i++) {
            should_switch = false;

            x = rows[i].getElementsByTagName("td")[column_num];
            y = rows[i + 1].getElementsByTagName("td")[column_num];
            if ((!order && x.innerText.toLowerCase() > y.innerText.toLowerCase()) ||
                (order && x.innerText.toLowerCase() < y.innerText.toLowerCase())) {
                should_switch = true;
                break;
            }
        }
        if (should_switch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
            let temp = rows[i];
            rows[i] = rows[i + 1];
            rows[i + 1] = temp;
        }
    }
}*/

for (let i = 0; i < ths.length; i++) {
    ths[i].setAttribute('data-column', i.toString());
    ths[i].onclick = sortHandler;
}

{#ths[0].classList.add("sorting-asc");#}
//sort(0, false);
entries.onchange(null);
ths[0].onclick(null);
/*let array = [1, 4, 7, 2, 6];
console.log(array);
console.log(quickSort(array, 0, array.length - 1, true));
console.log(quickSort(array, 0, array.length - 1, false));*/
/*for (let i of data_table.querySelectorAll("thead tr th")) {
    i.innerHTML += down_arrow + up_arrow;
}*/

</script>

{% if message %}
<script>
    alert("{{ message }}")
</script>
{% endif %}
{% endblock %}